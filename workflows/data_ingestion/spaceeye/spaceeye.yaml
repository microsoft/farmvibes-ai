name: spaceeye
sources:
  user_input:
    - preprocess.user_input
    - spaceeye.input_data
sinks:
  raster: spaceeye.raster
parameters:
  duration:
  time_overlap:
  min_tile_cover:
  max_tiles_per_time:
  cloud_thr:
  shadow_thr:
  pc_key:
  s2_timeout:
tasks:
  preprocess:
    workflow: data_ingestion/spaceeye/spaceeye_preprocess
    parameters:
      min_tile_cover: "@from(min_tile_cover)"
      max_tiles_per_time: "@from(max_tiles_per_time)"
      cloud_thr: "@from(cloud_thr)"
      shadow_thr: "@from(shadow_thr)"
      pc_key: "@from(pc_key)"
      s2_timeout: "@from(s2_timeout)"
  spaceeye:
    workflow: data_ingestion/spaceeye/spaceeye_inference
    parameters:
      duration: "@from(duration)"
      time_overlap: "@from(time_overlap)"
edges:
  - origin: preprocess.s2_raster
    destination:
      - spaceeye.s2_rasters
  - origin: preprocess.s1_raster
    destination:
      - spaceeye.s1_rasters
  - origin: preprocess.cloud_mask
    destination:
      - spaceeye.cloud_rasters
description:
  short_description:
    Runs the SpaceEye cloud removal pipeline, yielding daily cloud-free images for the input
    geometry and time range.
  long_description: >-
    The workflow fetches both Sentinel-1 and Sentinel-2 tiles that cover the input geometry and time
    range, preprocesses them, computes cloud masks, and runs SpaceEye inference in a sliding window
    on the retrieved tiles. This workflow can be reused as a preprocess step in many applications
    that require cloud-free Sentinel-2 data. For more information about SpaceEye, read the paper:
    https://arxiv.org/abs/2106.08408.
  sources:
    user_input: Time range and geometry of interest.
  sinks:
    raster: Cloud-free rasters.
  parameters:
